\documentclass[11pt,show 
notes,notheorems,noamsthm,blank]{beamer} % default is 11pt
\usetheme{metropolis}
% \usepackage{beamerthemeshadow}
% \usepackage{times}
\usepackage[utf8]{inputenc}
\usepackage[scaled]{helvet} % ss
\usepackage[T1]{fontenc}
\usepackage{eurosym}
\usepackage{graphics, graphicx}
\usepackage{url}
% \usepackage{multirow}
\usepackage{listings}
\usepackage{epsfig}
%  \usepackage[portuguese]{babel}
%  \usepackage[latin1]{inputenc}  
\usepackage{fancyvrb}
\usepackage[prefix=tikzsym]{tikzsymbols}

\usepackage{fontawesome}
% \usepackage{xcolor}


% \usepackage[marvosym]{tikzsymbols}
% \usepackage{rotating}
% \usepackage{subfigure}
% \usepackage{default}
 \usepackage{algorithmic}
 \usepackage{algorithm}
\usepackage{rotating}
\usepackage{hyperref}
\definecolor{links}{HTML}{FF5050}
\definecolor{inlinks}{HTML}{4D94FF}
\hypersetup{colorlinks,linkcolor=inlinks,urlcolor=links}
\beamertemplatetransparentcovered
%  \usepackage[portuguese]{babel}
%  \usepackage[latin1]{inputenc}  
\usepackage{rotating}
\usepackage{colortbl}
% \usepackage{moreverb}
% \usepackage{tikz}
% \usepackage{wrapfig}
\setbeamertemplate{bibliography item}{\insertbiblabel}
% \usepackage{tikz}
% \usetikzlibrary{arrows,positioning,shapes}
% \usetikzlibrary{shapes,calc,shadows}
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
% \pagestyle{fancy}
\pgfsetlayers{background,main,foreground}
\usepackage{url}
\usepackage{hyperref}
% \usepackage{color}X
\setbeamertemplate{navigation symbols}{}
% \renewcommand{\algorithmicrequire}{\textbf{Input:}}
% % \renewcommand{\algorithmicensure}{\textbf{Output:}}
% \hypersetup{
%     colorlinks,%
%     citecolor=BrickRed,%
%     filecolor=black,%
%     linkcolor=blue,%
%     urlcolor=BrickRed
% }





\usepackage{tikz}
\usetikzlibrary{calc,shapes.symbols,shapes.geometric,positioning,arrows,chains}
\usetikzlibrary{backgrounds,decorations,decorations.text,
decorations.pathreplacing}
% tiks definitions
\usetikzlibrary{arrows.meta}
\tikzstyle{default_rectangle} = [black, fill=white]
\tikzset{>=stealth}
\tikzset{every picture/.append style={font=\small}}
\usetikzlibrary{arrows, matrix, shadows}
\tikzset{>=stealth}
\tikzstyle{every picture}=[line width=0.75pt]
\tikzstyle{every instance}=[font=\small]
\tikzstyle{default_rectangle} = [black, fill=white]
\definecolor{myblue}{RGB}{68,119,170}
\definecolor{myred}{RGB}{204,102,119}
\definecolor{mygreen}{RGB}{17,119,51}
\definecolor{myyellow}{RGB}{221,204,119}
% Definitions for figures
\tikzstyle{server}=[circle,draw,minimum size=2em,scale=.9,solid,fill=green!20]
\tikzstyle{site}=[circle,draw,minimum size=2em,scale=.9,solid,fill=red!20]
\tikzstyle{root}=[circle,draw,minimum size=2em,scale=.9,solid,fill=red!20]
\tikzstyle{user}=[circle,draw,minimum size=2em,scale=.9,solid,fill=yellow!20]
\tikzstyle{cache}=[rectangle,draw,minimum 
size=3em,scale=.9,solid,fill=blue!20,minimum height=1em]

% Definitions for figures
\tikzstyle{server}=[circle,draw,minimum size=2em,scale=.9,solid,fill=green!20]
\tikzstyle{site}=[circle,draw,minimum size=2em,scale=.9,solid,fill=red!20]
\tikzstyle{root}=[circle,draw,minimum size=2em,scale=.9,solid,fill=red!20]
\tikzstyle{user}=[circle,draw,minimum size=2em,scale=.9,solid,fill=yellow!20]
\tikzstyle{cache}=[rectangle,draw,minimum 
size=3em,scale=.9,solid,fill=blue!20,minimum height=1em]


\usepackage{pgf}
\pgfdeclareimage[height=0.5cm]{logo}{fig/sidn-delft}
% \addtobeamertemplate{navigation symbols}{}{%
%     \usebeamerfont{footline}%
%     \usebeamercolor[fg]{footline}%
%     \hspace{1em}%
%     \insertframenumber/\inserttotalframenumber
% }

% \setbeamercolor{footline}{fg=blue}
\setbeamerfont{footline}{series=\bfseries}


% \setbeamerfont{}{family=\rmfamily,series=\bfseries,size={\fontsize{12}{36}}}

%  \logo{\pgfuseimage{logo}}

\begin{document}
\title{draft-moura-dnsop-authoritative-recommendations-02}  
\author[Moura et. al]{\textbf{Giovane C. M. Moura}$^{1,2}$, Wes Hardaker$^3$, 
\\John Heidemann$^3$, Marco Davids$^1$\\}
\vspace{-0.3cm}
\institute{$^1$SIDN Labs, $^2$TU Delft, $^3$USC/ISI\\
%    \includegraphics[width=9cm]{fig/logos.png}
}


   
   
\date {DNSOP -- IETF 104\\Prague, CZ\\
2019-03-XX\\


}  

\frame{\titlepage} 






\begin{frame}
\frametitle{Draft History}


\begin{itemize}


\item This is an \textbf{Informational} draft 
\item \textbf{Today:} first time presented at DNSOP 

\item Versions and mailing list discussion:

\begin{itemize}

  \item \textbf{-02 (2019-03-08):}   
\href{https://mailarchive.ietf.org/arch/msg/dnsop/u_w7KI7BkLmWQ7ii0P_PTEYBcus}{
 link  list thread }
 
 

  \item \textbf{-01 (2018-12-20):} 
\href{https://mailarchive.ietf.org/arch/msg/dnsop/2R8Ab4-7sKmOY7-XcJ3yLSq6Gcc}{
 link list thread (no responses)} 


  \item \textbf{-00 (2018-11-28):}   
\href{https://mailarchive.ietf.org/arch/msg/dnsop/AMMr6dDDUmShnG90URv6AJCY_VQ}{
 link list thread}

\end{itemize}

\item Github link: 
\begin{itemize}
 \item \small
\url{https://github.com/gmmoura/draft-moura-dnsop-authoritative-recommendations}

\end{itemize}



\end{itemize}


\end{frame}


\begin{frame}
 \frametitle{Context}
 
 \begin{itemize}

  \item 13 people that have had 5  research papers:
  \begin{itemize}
   \item \footnotesize Draft authors + Ricardo de O Schmidt, Wouter B. de 
Vries, Moritz M\"{u}ller, Lan Wei,  Cristian Hesselman, Jan Harm Kuipers, 
Pieter-Tjerk de Boer and Aiko  Pras.
  \end{itemize}

 \item Relevant papers with \textit{recommendations} backed by 
large-scale, Internet-wide measurements: 
\begin{itemize}
 \item 4x ACM IMC
 \item 1x PAM
\end{itemize}


\item However, papers tend to be \textit{long}, \textit{detailed} -- they 
explain \textit{why} 

 \end{itemize}

\end{frame}



\begin{frame}[fragile]
 \frametitle{\textbf{This draft:}}
 
 

 \lstset{language=Python}
 \lstset{frame=lines}
%  \lstset{caption={Insert code directly in your document}}
 \lstset{label={lst:code_direct}}
  \lstset{basicstyle=\footnotesize}
  
  
\begin{lstlisting}
papers=[]
papers.append(Moura16b)
papers.append(Mueller17b)
papers.append(Schmidt17a)
papers.append(Vries17b)
papers.append(Moura18b)

for p in papers:
  recommendations = TLDR(p) #great filter :-)
  print(recommendations)
\end{lstlisting}

\begin{itemize}
 \item Tangile,direct language to OPs folks interested on \textit{what} to do
 \item Reader is referred to papers to understand \textit{why}
\end{itemize}


\end{frame}

\begin{frame}
 \frametitle{Recommendations in a nutshell}
 
 \begin{itemize}
  \item R1: Use equaly strong IP anycast in every authoritative server to
    achieve even load distribution~\cite{Mueller17b}
    
  \item R2:  Routing Can Matter More Than Locations~\cite{Schmidt17a}
  
  \item R3: Collecting Detailed Anycast Catchment Maps Ahead of Actual
    Deployment Can Improve Engineering Designs~\cite{Vries17b}
    
  \item R4:    When under stress, employ two strategies~\cite{Moura16b}
  
  \item R5:  Consider longer time-to-live values whenever 
possible~\cite{Moura18b}
  
    \item R6:  Shared Infrastructure Risks Collateral Damage During 
Attacks~\cite{Moura16b}
    


  

 \end{itemize}

\end{frame}


\begin{frame}
 \frametitle{R1: Use equaly strong IP anycast in every authoritative server to
    achieve even load distribution}
    
    
    
\begin{figure}
\centering

  \input{fig-setup.tex}
  \caption{Clients, Resolver and authoritatives relationship.}
  \label{fig:nl-deployment}
% \end{minipage}

\end{figure}
\vspace{-0.5cm}
\begin{itemize}
 \item\textbf{Auth goal}: serve resolvers with \textit{shortest} RTT
 \item Resolver \textbf{has to choose} from AT1--AT4
\end{itemize}



\end{frame}

\begin{frame}
 \frametitle{R1: Use equaly strong IP anycast in every authoritative server to
    achieve even load distribution}
    
\begin{itemize}
%  \item We carried large-scale measurements in~\cite{Mueller17b}, 
% using Ripe Atlas.
% \item We verified them using \url{.nl} and Root DNS (DITL) data
\item Finding using Atlas, \url{.nl}, and DITL (Root DNS) 
datas~\cite{Mueller17b} : 

\begin{enumerate}
                \item Resolvers query \textit{all} available authoritatives
                \item However, their load distribution is uneven: closer 
authoritatives get \textit{more} queries -- but not all
               \end{enumerate}

\item Implications: 
\begin{itemize}
 \item For an auth operator, the latency of \textit{all} authoritative matter
%  \item Therefore, they should be similarly capable 
  \item Unicast, by definition, cannot deliver good global performance 
  \item \cite{Mueller17b} recommends then use anycast in \textit{all} NS 
records, equally strong (peering and capacity), and phase out unicast.

\item This has been applied in \url{.nl}.
\end{itemize}


\end{itemize}


\end{frame}
 


\begin{frame}
 \frametitle{R2: Routing Can Matter More Than Locations}
 
 \begin{itemize}
  \item When choosing an anycast DNS provider, people always ask ``how many 
sites/instances'' it has
 \item People sometimes assume more sites/instances lead to better client's 
experience (lower RTT)
 \item \cite{Schmidt17a} shows that this is not always true, and that 
\textit{routing} can matter more than number of locations. For example:
\begin{itemize}
 \item \texttt{c-root}: 8 locations. 
 \item \texttt{k-root}: 33 locations
 \item \texttt{l-root}: 144 locations
 \item Their\textbf{ median RTT: 30--32\,ms }to 7.9k Atlas probes
\end{itemize}


 \end{itemize}

\end{frame}


\begin{frame}
 \frametitle{R2: Routing Can Matter More Than Locations}
 
\begin{itemize}
 \item Why? BGP is agnostic to geographical distance
 \item \cite{Schmidt17a} thus recommends to consider routing and connectivity 
when engineering DNS anycast services
\item They show that 12 sites is enough to provide good global latency 
\item However, more sites may be helpful in case of DDoS~\cite{Moura16b}
\end{itemize}


\end{frame}

\begin{frame}
 \frametitle{R3: Collecting Detailed Anycast Catchment Maps Ahead of Actual
    Deployment Can Improve Engineering Designs}
    
    \begin{itemize}
     \item Say you run an anycast service with $n$  instances
     \item  Say you want to add 1 more  instance in SFO
     \item How will that affect traffic among your other locations?
      \begin{itemize}
       \item Very hard to predict
       \item BGP maps clients to locations
      \end{itemize}

    \end{itemize}

    
\end{frame}


\begin{frame}
 \frametitle{R3: Collecting Detailed Anycast Catchment Maps Ahead of Actual
    Deployment Can Improve Engineering Designs}
    
\begin{itemize}
 \item Solution: detailed anycast catchment maps
 \item \cite{Vries17b} present a tool (Verfploeter) that does that using ICMP
%  \item They run it on B-root \textit{before} moving to anycast
 \item They predicted \texttt{b-root} catchments and  query loads:
 \begin{itemize}
  \item  Load predict going to \texttt{b-root} LAX instance: 81.6\% 
  \item Actual load: 81.4\%.
 \end{itemize}
 \item OPs: you can use it on a test prefix, announced from the same locations 
as your production network; run it with different configurations and make 
informed choices

\item To date: running on a testbed, B-root, and a large unnamed operator. 
 
\end{itemize}


    
\end{frame}

\begin{frame}
 \frametitle{R4: When under stress, employ two strategies}
 \begin{figure}
\centering

  \input{fig-ddos.tex}
%   \caption{DDoS against an anycast service}
  \label{fig:nl-deployment}
% \end{minipage}

\end{figure}



% \textbf{BGP will map traffic to locations}
\pause
\begin{itemize}
 \item BGP will map traffic to locations
%  \item Often uneven distribution
 \item What to do? Depends on the attack
 \begin{enumerate}
   \item \textcolor{red}{\textbf{Do nothing and let LAX become a degraded 
absorber} }

\pause
   \item \textcolor{inlinks}{\textbf{Withdraw/prepend routes to shift traffic  }}

 \end{enumerate}
\pause
 \item Best option depends on attack and NS specifics
\end{itemize}


\end{frame}

\begin{frame}
 \frametitle{R5: Consider longer TTL values whenever 
possible}
\begin{itemize}
 \item TTLs set how long queries should remain in resolver's cache
\begin{itemize}
   \item Sort of ``ephemeral replication''
\end{itemize}

%  \item \cite{Moura18b} found that caching works 70\% as expected in the wild
 \item They also emulate DDoS attacks (50-100\% packet loss)
%  \begin{itemize}
%   \item Caching is a \textit{key} component of resolver's resilience
%   \item Retries as well (90\% packet loss, 27\% still get an answers, caching 
% boots this number)
% % \item When cache expires, only resolvers serving slate 
% % content\footnote{\url{
% % https://tools.ietf.org/html/draft-ietf-dnsop-serve-stale-03}} can help you
%  \end{itemize}

 
\end{itemize}


\begin{figure}
\centering
\includegraphics[width=0.7\columnwidth]{fig/hist.pdf}
 \caption{TTL: 1h; 100\%  Packet loss after $t=10$min}
\label{fig:class-valid-queries}
\end{figure}

\end{frame}


\begin{frame}
 \frametitle{R5: Consider longer TTL values whenever 
possible}
\begin{itemize}
 
 
 \item Caching is a \textit{key} component of resolver's resilience
   \item Retries as well -- to the point that resolvers may ``hammer'' 
authoritatives
   
   
 \item As such, \cite{Moura18b} recommend longer TTLs whenever possible
 
 
 \end{itemize}
 
 
\end{frame}

\begin{frame}
 \frametitle{R6:  Shared Infrastructure Risks Collateral Damage During 
Attacks}
 \begin{itemize}
  \item Be careful when hiring/engineering DNS services: co-location implies 
you shared some (parts of the) infrastructure

\item \cite{Moura16b} found that co-located \url{.nl} sites suffered during 
DDoS against Roots
\item Dyn 2016 Attack shows the same

\item OPS: be aware of shared infrastructure risk
 \end{itemize}

\end{frame}



\begin{frame}
 \frametitle{Questions?}
 
 
 \begin{itemize}
  \item Draft on GitHub: \small
\url{https://github.com/gmmoura/draft-moura-dnsop-authoritative-recommendations}
 \end{itemize}

\end{frame}
 
 \begin{frame}[allowframebreaks] {References}
 
\bibliographystyle{IEEEtran}
% \balance
\small
\bibliography{subset,rfc}
\end{frame}
 
\end{document}
